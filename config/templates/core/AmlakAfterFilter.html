{% extends 'main/base.html' %}
{% block content %}
{% load static %}
{% load humanize %}
{% load mathfilters %}
{% load base_tags %}







<section class="section-content padding-y">
    <div class="container">
    
        <div class="row">


            <aside class="col-md-3">
                
                <div class="card">
                    <article class="filter-group">
                        <header class="card-header">
                            <a href="#" data-toggle="collapse" data-target="#collapse_1" aria-expanded="true" class="">
                                <h6 class="title">دسته ها</h6>
                                
                            </a>
                        </header>
                        <div class="filter-content collapse show" id="collapse_1" style="">
                            <div class="card-body">
                                
                                <ul class="list-menu">
                                    {% for cat in cat_childs %}
                                        <li><a id="ParentCats" class="eachCat-{{cat.id}}" href="{% url 'eachCategorySecondlevel' cat.id %}" class="eachCat">{{cat.title}}  </a></li>
                                    {% endfor %}
                                </ul>
                
                            </div> <!-- card-body.// -->
                        </div>
                    </article> 
                    <article class="filter-group">
                        <header class="card-header">
                            <a href="#" data-toggle="collapse" data-target="#collapse_4" aria-expanded="true" class="">
                    
                                <br>
                                {% if catMain.title == "املاک" %}
                                <button type="button" class="btn btn-outline-dark" data-toggle="modal" data-target="#exampleModal">
                                    محل
                                </button>
                                    
                                    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    
                                        <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                            <h5 class="modal-title" id="exampleModalLabel"> تعیین محل</h5>
                                            
                                            </div>
                                            <div class="modal-body">
                                                <p>حداقل یک محله انتخاب کنید.</p>
                                                <br>
                                                <div class="aa">
                                                    <form action="" method="get" id="chooseLocation">
                                                        {% for c in cits %}
                                                            {% for loc in c.location_set.all %}
                                                                <a href="#" style="color:black;text-decoration:none">{{loc.name}}</a>
                                                                <input  type="checkbox" name="ids" id="" value="{{loc.id}}">
                                                                <br>
                                                            {% endfor %}
                                                        {% endfor %}
                                                        <br>
                                                        <br>
                                                        <br>
                                                        <button type="submit" class="btn btn-primary">Save changes</button>
                                                    </form>
                                                    <br>
                                                    <br>
                                                
                                                </div>
                                            </div>
                                            
                                        </div>
                                        </div>
                                    </div>
                                    <br>
                                    <br>
                                    <div class="form-row">

                                        <div class="form-group col-md-6">
                                        <label>Min</label>
                                        <!-- <input class="form-control" placeholder="$0" type="number"> -->
                                            <select class="mr-2 form-control" id="choose_min_price" name="least_price">
                                                <!-- <option selected="selected" value="0"></option> -->

                                                {% if least_price == 5 %}
                                                    <option value="5" selected="selected">5 میلیون</option>

                                                {% else %}
                                                    <option value="5" >5 میلیون</option>

                                                {% endif %}
                                                {% if least_price == 10 %}
                                                    <option value="10" selected="selected">10 میلیون</option>

                                                {% else %}
                                                    <option value="10" >10 میلیون</option>

                                                {% endif %}
                                                {% if least_price == 20 %}
                                                    <option value="20" selected="selected">20 میلیون</option>

                                                {% else %}
                                                    <option value="20" >20 میلیون</option>

                                                {% endif %}
                                                {% if least_price == 50 %}
                                                    <option value="50" selected="selected">50 میلیون</option>

                                                {% else %}
                                                    <option value="50" >50 میلیون</option>

                                                {% endif %}
                                                {% if least_price == 100 %}
                                                    <option value="100" selected="selected">100 میلیون</option>

                                                {% else %}
                                                    <option value="100" >100 میلیون</option>

                                                {% endif %}
                                                {% if least_price == 200 %}
                                                    <option value="200" selected="selected">200 میلیون</option>

                                                {% else %}
                                                    <option value="200" >200 میلیون</option>

                                                {% endif %}
                                            </select>
                                        </div>
                                        <div class="form-group text-right col-md-6">
                                        <label>Max</label>
                                            <select class="mr-2 form-control" id="choose_max_price" name="max_price">
                                                <!-- <option selected="selected" value="400000000"></option> -->
                                                {% if max_price == 5 %}
                                                    <option value="5" selected="selected">5 میلیون</option>

                                                {% else %}
                                                    <option value="5" >5 میلیون</option>

                                                {% endif %}
                                                {% if max_price == 10 %}
                                                    <option value="10" selected="selected">10 میلیون</option>

                                                {% else %}
                                                    <option value="10" >10 میلیون</option>

                                                {% endif %}
                                                {% if max_price == 20 %}
                                                    <option value="20" selected="selected">20 میلیون</option>

                                                {% else %}
                                                    <option value="20" >20 میلیون</option>

                                                {% endif %}
                                                {% if max_price == 50 %}
                                                    <option value="50" selected="selected">50 میلیون</option>

                                                {% else %}
                                                    <option value="50">50 میلیون</option>

                                                {% endif %}
                                                {% if max_price == 100 %}
                                                    <option value="100" selected="selected">100 میلیون</option>

                                                {% else %}
                                                    <option value="100" >100 میلیون</option>

                                                {% endif %}
                                                {% if max_price == 200 %}
                                                    <option value="200" selected="selected">200 میلیون</option>

                                                {% else %}
                                                    <option value="200" >200 میلیون</option>

                                                {% endif %}
                                                
                                            </select>
                                        </div>
                                    </div> 

                                    <br>
                                    <br>
                                    <br>
                                    
                                        <a href="#" style="color:black;text-decoration:none">فقط عکس دار</a>
                                            <input  type="checkbox"  id="justImg" {% if justImg %} checked="checked"{% endif %}>
                                        <br>
                                        <a href="#" style="color:black;text-decoration:none">فقط فوری ها</a>
                                            <input  type="checkbox"  id="justIm" {% if instatnceComs == "فوری" %} checked="checked" {% endif %} >

                                        <br>
                                        
                                    
                                
                                        <script type="text/javascript" >

                                            $("#justImg").change(function(){

                                                    let r7=$("#chooseLocation")
                                                    let min_price_value=$("#choose_min_price").val()
                                                    let max_price_value=$("#choose_max_price").val()
                                                    let ch= r7.children("input").filter("input[type=checkbox]:checked")
                                                    let ids=[]
                                                    ch.each(function(index,el){
                                                        ids.push($(el).attr("value"))
                                                    })
                                                
                                                var instanceStatus=$("input[type=checkbox][id=justIm]")

                                              
                                                
                                                if ( $(this).is(":checked")){

                                                    if(instanceStatus.is(":checked")){
                                                        window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${ids.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=True&instatnceComs=فوری`

                                                    }else{
                                                        window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${ids.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=True&instatnceComs=عادی`

                                                    }
                                                    
                                                    


                                                }else{
                                                    
                                                    if(instanceStatus.is(":checked")){
                                                        window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${ids.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=&instatnceComs=فوری`

                                                    }else{
                                                        window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${ids.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=&instatnceComs=عادی`

                                                    }
                                                    
                                                }
                                                

                                                

                                            })



                                            $("#justIm").change(function(){


                                                let r7=$("#chooseLocation")
                                                let min_price_value=$("#choose_min_price").val()
                                                let max_price_value=$("#choose_max_price").val()
                                                let ch= r7.children("input").filter("input[type=checkbox]:checked")
                                                let ids=[]
                                                ch.each(function(index,el){
                                                    ids.push($(el).attr("value"))
                                                })

                                            var imgStatus=$("input[type=checkbox][id=justImg]")

                                          
                                            
                                            if ( $(this).is(":checked")){

                                                

                                                if(imgStatus.is(":checked")){
                                                    window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${ids.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=True&instatnceComs=فوری`

                                                    
                                                }else{
                                                    window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${ids.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=&instatnceComs=فوری`

                                                }
                                                
                                                
                                                




                                            }else{
                                                
                                                if(imgStatus.is(":checked")){
                                                    window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${ids.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=True&instatnceComs=عادی`

                                                    
                                                }else{
                                                    window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${ids.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=&instatnceComs=عادی`

                                                }

                                            }
                                            

                                            

                                        })


                                            


                                            $("#chooseLocation").submit(function(e){

                                                e.preventDefault();
                                                const form=new FormData(this)
                                                let min_price_value=$("#choose_min_price").val()
                                                let max_price_value=$("#choose_max_price").val()

                                                let locationIds=[]

                                                for(let i of form){
                                            
                                                    locationIds.push(i[1])
                                                }
                                                let locsIdsToInt=locationIds.map(item=>Number(item))

                                                var imgStatus=$("input[type=checkbox][id=justImg]")
                                                var instanceStatus=$("input[type=checkbox][id=justIm]")

                                                if(imgStatus.is(":checked") && instanceStatus.is(":checked")){

                                                    window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${locsIdsToInt.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=True&instatnceComs=فوری`


                                                }else if(!imgStatus.is(":checked") && instanceStatus.is(":checked")){
                                                    window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${locsIdsToInt.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=&instatnceComs=فوری`

                                                }else if(imgStatus.is(":checked") && !instanceStatus.is(":checked")){
                                                    window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${locsIdsToInt.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=True&instatnceComs=عادی`
                                                }else if(!imgStatus.is(":checked") && !instanceStatus.is(":checked")){
                                                    window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${locsIdsToInt.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=&instatnceComs=عادی`
                                                }





                                                
                                                
                                                
                                            });


                                            


                                            
                                            $("#choose_max_price").change(function(){
                                                
                                                let r7=$("#chooseLocation")
                                                let min_price_value=$("#choose_min_price").val()
                                                let max_price_value=$("#choose_max_price").val()
                                                let ch= r7.children("input").filter("input[type=checkbox]:checked")
                                                let ids=[]
                                                ch.each(function(index,el){
                                                    ids.push($(el).attr("value"))
                                                })

                                                var imgStatus=$("input[type=checkbox][id=justImg]")
                                                var instanceStatus=$("input[type=checkbox][id=justIm]")

                                                if(imgStatus.is(":checked") && instanceStatus.is(":checked")){
                                                    window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${ids.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=True&instatnceComs=فوری`                                                        
                                                }else if(!imgStatus.is(":checked") && instanceStatus.is(":checked")){
                                                    window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${ids.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=&instatnceComs=فوری`
                                                }else if(imgStatus.is(":checked") && !instanceStatus.is(":checked")){
                                                    window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${ids.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=True&instatnceComs=عادی`

                                                }else if(!imgStatus.is(":checked") && !instanceStatus.is(":checked")){
                                                    window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${ids.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=&instatnceComs=فوری`
                                                    
                                                }
                                                
                                                
                                            });



                                            $("#choose_min_price").change(function(){
                                                
                                                let r7=$("#chooseLocation")
                                                let min_price_value=$("#choose_min_price").val()
                                                let max_price_value=$("#choose_max_price").val()
                                                let ch= r7.children("input").filter("input[type=checkbox]:checked")
                                                let ids=[]
                                                ch.each(function(index,el){
                                                    ids.push($(el).attr("value"))
                                                })
                                                
                                                var imgStatus=$("input[type=checkbox][id=justImg]")
                                                var instanceStatus=$("input[type=checkbox][id=justIm]")

                                                if(imgStatus.is(":checked") && instanceStatus.is(":checked")){
                                                    window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${ids.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=True&instatnceComs=فوری`                                                        
                                                }else if(!imgStatus.is(":checked") && instanceStatus.is(":checked")){
                                                    window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${ids.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=&instatnceComs=فوری`
                                                }else if(imgStatus.is(":checked") && !instanceStatus.is(":checked")){
                                                    window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${ids.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=True&instatnceComs=عادی`

                                                }else if(!imgStatus.is(":checked") && !instanceStatus.is(":checked")){
                                                    window.location.href=`http://127.0.0.1:8000/amlakFilter/?ids=${ids.join(',')}&least_price=${min_price_value}&max_price=${max_price_value}&justImg=&instatnceComs=فوری`
                                                    
                                                }
                                            
                                            });


 

                                        </script>
                                {% endif %}
                            </a>
                        </header>
                        
                    </article> 
                    
                    <article class="filter-group">
                        <header class="card-header">
                            <a href="#" data-toggle="collapse" data-target="#collapse_3" aria-expanded="true" class="">
                                <i class="icon-control fa fa-chevron-down"></i>
                                <h6 class="title">Price range </h6>
                            </a>
                        </header>
                        
                    </article> 
                    
                </div> 
        
            </aside> 


            <main class="col-md-9">
        
                <!-- <header class="border-bottom mb-4 pb-3">
                        <div class="form-inline">
                            <span class="mr-md-auto">32 Items found </span>
                            
                        </div>
                </header> -->
        
                <div class="row">
                    {% for c in coms_to_show %}

                        <div class="col-md-4">
                            <figure class="card card-product-grid" >
                                <div class="img-wrap"> 
                                    {% if c.commericalimage_set.all %}
                                            <img src="{{c.commericalimage_set.first.image.url}}">
                                    {% endif %}
                                    
                                </div> <!-- img-wrap.// -->
                                <figcaption class="info-wrap" >
                                    <div class="fix-height" style="height:100px">
                                        <a href="./product-detail.html" class="title">
                                            {{c.title|slice:"20"}}
                                        </a>
                                        <div class="price-wrap mt-2">

                                            {% if c.parent.parent.parent %}

                                                        {% if c.parent.parent.parent.title == "املاک" %}

                                                                {% if  c.parent.parent.title == "فروش مسکونی" %}
                                                                    <span class="price">{{c.price|intcomma}}</span>    تومان
                                                                    <br>
                                                                    <span class="price">{{c.iranTimeCreated|findTime}}</span>    

                                                                {% elif  c.parent.parent.title == "اجاره مسکونی" %}

                                                                    ودیعه <span class="price">{{c.vadieh|intcomma}}</span>    تومان
                                                                        <br>
                                                                        اجاره <span class="price">{{c.rent|intcomma}}</span>    تومان
                                                                        <br>
                                                                        <span class="price">{{c.iranTimeCreated|findTime}}</span>
                                                                        <br>

                                                                {% endif %}

                                                                <!-- وسایل نقلیه -->

                                                        {% elif c.parent.parent.parent.title == "وسایل نقلیه" %}

                                                                {% if c.parent.parent %}

                                                                    <!-- خودرو -->

                                                                    {% if c.parent.parent.title == "خودرو" %}

                                                                        {% if c.parent.title == "سواری و وانت" %}
                                                                                <span class="price">{{c.karkard_mashin|intcomma}}</span> کیلومتر
                                                                                <br>
                                                                                <span class="price">{{c.price|intcomma}}</span> تومان
                                                                                <span class="price">{{c.iranTimeCreated|findTime}}</span>

                                                                        {% elif c.parent.title == "کلاسیک" %}
                                                                                <span class="price">{{c.karkard_mashin|intcomma}}</span> کیلومتر
                                                                                <br>
                                                                                <!-- <span class="price">{{c.price|intcomma}}</span> تومان -->
                                                                                <span class="price">{{c.iranTimeCreated|findTime}}</span>
                                                                        {% elif c.parent.title == "اجاره" %}
                                                                                <span class="price">{{c.day_rent_paid|intcomma}}</span> تومان
                                                                                <br>
                                                                                <!-- <span class="price">{{c.price|intcomma}}</span> تومان -->
                                                                                <span class="price">{{c.iranTimeCreated|findTime}}</span>   
                                                                        {% elif c.parent.title == "سنگین" %}
                                                                                <span class="price">{{c.price|intcomma}}</span> تومان
                                                                                <br>
                                                                                <!-- <span class="price">{{c.price|intcomma}}</span> تومان -->
                                                                                <span class="price">{{c.iranTimeCreated|findTime}}</span> 

                                                                        {% endif %}

                                                                    {% endif %}
                                                                
                                                                {% endif %}
                                                        
                                                        {% elif c.parent.parent.parent.title == "کالای دیجیتال" %}
                                                                
                                                                {% if c.parent.parent %}
                                                                        {% if c.parent.parent.title == "موبایل و تبلت" %}
                                                                                {% if c.parent.title == "گوشی موبایل" %}
                                                                                    <span class="price">{{c.phone_status}}</span> 
                                                                                    <br>
                                                                                    <span class="price">{{c.price|intcomma}}</span> تومان
                                                                                    <br>
                                                                                    <!-- <span class="price">{{c.price|intcomma}}</span> تومان -->
                                                                                    <span class="price">{{c.iranTimeCreated|findTime}}</span> 
                                                                                {% elif c.parent.title == "تبلت" %}

                                                                                    <span class="price">{{c.phone_status}}</span> 
                                                                                    <br>
                                                                                    <span class="price">{{c.price|intcomma}}</span> تومان
                                                                                    <br>
                                                                                    <!-- <span class="price">{{c.price|intcomma}}</span> تومان -->
                                                                                    <span class="price">{{c.iranTimeCreated|findTime}}</span> 
                                                                                {% elif c.parent.title == "لوازم جانبی موبایل و تبلت" %}

                                                                            
                                                                                    <span class="price">{{c.price|intcomma}}</span> تومان
                                                                                    <br>
                                                                                    <!-- <span class="price">{{c.price|intcomma}}</span> تومان -->
                                                                                    <span class="price">{{c.iranTimeCreated|findTime}}</span> 

                                                                                {% elif c.parent.title == "سیم کارت" %}

                                                                                
                                                                                {% endif %}
                                                                        {% elif c.parent.parent.title == "رایانه" %}
                                                                                {% if c.parent.title == "رایانه همراه" %}
                                                                                    <span class="price">{{c.phone_status}}</span> 
                                                                                    <br>
                                                                                    <span class="price">{{c.price|intcomma}}</span> تومان
                                                                                    <br>
                                                                                    <!-- <span class="price">{{c.price|intcomma}}</span> تومان -->
                                                                                    <span class="price">{{c.iranTimeCreated|findTime}}</span> 
                                                                                {% elif c.parent.title == "رایانه رومیزی" %}

                                                                                    <span class="price">{{c.phone_status}}</span> 
                                                                                    <br>
                                                                                    <span class="price">{{c.price|intcomma}}</span> تومان
                                                                                    <br>
                                                                                    <!-- <span class="price">{{c.price|intcomma}}</span> تومان -->
                                                                                    <span class="price">{{c.iranTimeCreated|findTime}}</span> 
                                                                                {% elif c.parent.title == "قطعات و لوازم جانبی" %}
                                                                                    <span class="price">{{c.phone_status}}</span> 
                                                                                    <br>
                                                                                    <span class="price">{{c.price|intcomma}}</span> تومان
                                                                                    <br>
                                                                                    <!-- <span class="price">{{c.price|intcomma}}</span> تومان -->
                                                                                    <span class="price">{{c.iranTimeCreated|findTime}}</span> 
                                                                                {% elif c.parent.title == "مودم و شبکه" %}
                                                                                    <span class="price">{{c.phone_status}}</span> 
                                                                                    <br>
                                                                                    <span class="price">{{c.price|intcomma}}</span> تومان
                                                                                    <br>
                                                                                    <!-- <span class="price">{{c.price|intcomma}}</span> تومان -->
                                                                                    <span class="price">{{c.iranTimeCreated|findTime}}</span>
                                                                                
                                                                                {% endif %}

                                                                        {% endif %}
                                                                {% endif %}

                                                        {% endif %}


                                            {% elif not c.parent.parent.parent %}
                                                    {% if c.parent.parent %}
                                                                    {% if c.parent.parent.title == "وسایل نقلیه" %}
                                                                                {% if c.parent.title == "موتور سیکلت" %}

                                                                                        <span class="price">{{c.price|intcomma}}</span> تومان
                                                                                        <br>
                                                                                        <span class="price">{{c.iranTimeCreated|findTime}}</span> 
                                                                                
                                                                                {% elif c.parent.title == "قطعات یدکی" %}

                                                                                        <span class="price">{{c.price|intcomma}}</span> تومان
                                                                                        <br>
                                                                                        <span class="price">{{c.iranTimeCreated|findTime}}</span>

                                                                                {% elif c.parent.title == "قایق و سایر" %}
                                                                                        <span class="price">{{c.price|intcomma}}</span> تومان
                                                                                        <br>
                                                                                        <span class="price">{{c.iranTimeCreated|findTime}}</span>
                                                                                {% endif %}
                                                                        

                                                                    {% endif %}
                                                    {% endif %}
                                                                            
                                            {% endif %}
                                            
                                        </div> 
                                    </div>
                                    <br>
                                    <br>
                                    <br>
                                    <a href="#" class="btn btn-block btn-success">Added to cart </a>
                                </figcaption>
                            </figure>
                        </div> 
                    {% endfor %}
                  
                </div> 
        
        
                <nav class="mt-4" aria-label="Page navigation sample">
                    <ul class="pagination">
                        <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item"><a class="page-link" href="#">Next</a></li>
                    </ul>
                </nav>
        
            </main> 
        
        </div>
    
    </div> 
</section>
















{% endblock content %}
